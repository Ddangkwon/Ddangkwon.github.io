---
layout : post
title : [C] 전처리기 지시자
comments : true
categories : 
- C
tags : []
---
# 전처리기 지시자

전처리는 C에서 컴파일러로 보내기 전 소스 코드를 만들고 수정할 수 있도록 하는 과정을 말한다.


## 매크로

매크로의 사용법으로는,

- 상수 정의
- 함수 매크로 작성
- 루프 풀기
- 헤더 가드(#ifndef)
- 코드 생성
- 조건 생성(#ifdef)

## [#] 매크로

매크로를 확장할 때 [#] 연산자는 매개변수를 한 쌍의 따옴표로 둘러싼 문자 형태로 변환한다.

```c
#include <stdio.h>
#define PRINT(s)    printf(#s)

int main()
{
    PRINT(HELLO WORLD);
    return 0;
}
```
## [##] 매크로

[##] 연산자의 경우 매크로 정의에서 매개변수와 다른 요소를 문자열로 결합해 변수 이름을 만든다.

```c
#include <stdio.h>
#include <string.h>

#define CMD(NAME) \
  char NAME ## _cmd[256]  = ""; \
  strcpy(NAME ## _cmd, #NAME);

int main(int argc, char** argv) {

  CMD(copy)
  CMD(paste)
  CMD(cut)

  char cmd[256];
  scanf("%s", cmd);

  if (strcmp(cmd, copy_cmd) == 0) {
    // ...
  }
  if (strcmp(cmd, paste_cmd) == 0) {
    // ...
  }
  if (strcmp(cmd, cut_cmd) == 0) {
    // ...
  }

  return 0;
}
```

## 가변인자 매크로

가변인자 매크로의 경우 가변 인수를 받을 수 있는 매크로를 말한다.

#define LOG_ERROR(format, ...) \
  fprintf(stderr, format, __VA_ARGS__)

'...' 가변인수가 __VA_ARGS__ 식별자로 대체되는 형태
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define VERSION "1.0.0"

#define LOG_ERROR(format, ...) \
  fprintf(stderr, format, __VA_ARGS__)

int main(int argc, char** argv) {

  if (argc < 3) {
    LOG_ERROR("Invalid Input %s\n.",
            VERSION);
    exit(1);
  }

  if (strcmp(argv[1], "-n") != 0) {
    LOG_ERROR("%s  %d  Version(%s).",
            argv[1], 1, VERSION);
    exit(1);
  }

  // ...

  return 0;
}

```

## 매크로의 장점과 단점

C 매크로는 전처리된 형태의 영향을 잘 알고 사용하면 장점을 갖는다.

하지만 남용할 경우 해당 코드가 재사용이 가능한 모듈로 패키징하려고 하지만 매크로를 남용할 경우,
컴파일 된 최종 이진파일에서는 모듈성을 전혀갖지 않는 단점도 있다.


## 조건부 컴파일

- #ifndef, #ifdef ~ #endif
- #pragma once
