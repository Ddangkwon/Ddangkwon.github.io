---
layout : post
title : FreeRTOS 내용정리
comments : true
categories : 
- Embedded Engineering
tags : [Embedded Engineering]
---
# FreeRTOS 내용정리

## Task

- 태스크는 가상의 CPU를 각자 가지고 있는 것처럼 동작한다.(Time Division)
- 태스크 간에는 커널 서비스인 Inter Process Communication 방법을 사용하여 통신한다.

## Round Robin 스케쥴링
- 모든 태스크들이 CPU 자원을 공평하게 나누어 사용하는 개념
- 각 태스크가 점유하는 시간을 타임 퀀텀이라고 하고 그 시간은 대락 1ms~20ms 사이이다.
- 비 선점형 스케쥴링을 필요로 할 때 사용한다.

## Priority 스케쥴링
- 태스크를 중요도에 의해 가중치를 두어 우선적으로 실행 할 수 있도록 하는 개념
- RTOS 에서 피룻적으로 지원하는 스케쥴링 방법
- 선점형 스케쥴링의 특성을 가짐

## Blocking I/O, Non blocking I/O

Blocking I/O
- 태스크가 시스템콜을 호출했어도 점유한 데이터가 즉시 가용되지 않더라도 그 동작이 완료될 때 까지 suspending 상태를 유지한 것을 말함.

Non blocking I/O
- 태스크가 시스템콜을 호출했어도 점유한 데이터가 즉시 가용되지 않을 땐 리턴하는 것이 특징
- Blocking 과는 다르게 프로세스가 쉬고있지 않음.

## RTOS 정의 및 특징
RTOS 는 임베디드 시스템 전용 운영체제이자 실시간 멀티태스킹 지원을 위한 운영체제이다.

RTOS 특징은 크게 다음과 같다.
- Hard Realtime
- Scalability
- Preemptive(선점형)
- Multitasking
- Deterministic(예측가능)
- Portability
- Robustness

## Real-Time 시스템

정해진 시간 내에 임무를 수행하는 시스템

Soft RealTime System
- 가능한 빠르게 임무를 수행하는게 목표이고, 정해진 시간 내에 수행할 필요는 없음(Timeout 발생해도 계속 실행)
Hard RealTime System
- 어떤 사건이 발생했을 때 정확하게 동작하는 것은 물론이고, 정해진 시간 내에 수행해야함(Timeout 발생 시 fail)

## RTOS 종류

FreeRTOS, Green Hills, VxWorks, Window Embedded, Texas Instruments

## FreeRTOS 특징
- Portable(이식성 좋음)
- ROMable(설정이나 응용프로그램에 따라 메모리의 크기를 바꿀 수 있음)
- 선점형 스케쥴링
- Round-Robin 지원
- Real-Time 기반으로 빠른 응답성을 가짐
- Multitasking
- MIT License


## CMSIS


Cortex Microcontroller Software Interface Standard의 약자.

즉 다양한 칩 벤더가 Cortex 시리즈의 IP를 라이센스해가면서 하드웨어 독립적인 표준화된 소프트웨어 인터페이스가 필요하게 된다. 스펙은 ARM에 사용자 등록을 하면 받을 수 있다. CMSIS는 CMSIS-CORE, CMSIS-Driver, CMSIS-DSP, CMSIS-RTOS API, CMSIS-Pack, CMSIS-SVD, CMSIS-DAP 로 구성된다.

CMSIS 소프트웨어 인터페이스는 소프트웨어 재사용을 단순화하고 MCU 개발자의 학습 곡선을 줄여 개발 속도를 단축 시킨다.
CMSIS 는 프로세서 및 주변 장치, 실시간 운영 체제 및 미들웨어 구성 요소에 대한 인터페이스를 제공한다. CMSIS 에는 장치, 보드 및 소프트웨어에 대한 전달 메카니즘이 포함되어 있고, 여러 타 사 업체의 소프트웨어 구성요소와 결합이 가능하다.

## 포팅(Porting) 

이식(移植) 또는 포팅(porting)은 컴퓨터 과학에서 실행 가능한 프로그램이 원래 설계된 바와 다른 컴퓨팅 환경(이를테면 CPU, 운영 체제, 서드 파티 라이브러리 등)에서 동작할 수 있도록 하는 과정을 가리킨다. 이 용어는 소프트웨어나 하드웨어가 다른 환경에서 사용할 수 있게 변경되는 것에도 해당한다. 소스 하나로 여러 플랫폼에서 사용할 수 있는 것을 크로스 플랫폼으로 부른다.


## 태스크 함수 구성 요소

태스크 함수의 경우 태스크 함수, 함수의 이름, 스택 항목의 개수, 태스크 전달 파라미터, 우선순위, 핸들러 등으로 구성된다.
그리고 태스크 스택의 경우 heap 영역이나 .bss 영역에 저장된다.

그리고 태스크의 우선순위를 매길 때 보통 높은 숫자가 높은 우선순위를 나타내기 때문에,

낮은 우선순위에는 명확한 낮은 숫자를, 높은 우선 순위에는 명확히 높은 숫자를 사용하여 한 눈에 구분이 가게하는 것이 좋다.

그리고 Task의 경우

TaskMain()
- Task1()
- Task2()
- Task3()

와 같은 함수를 가지고 있다.

## TaskCreate() 함수

태스크 객체를 만들어주는 함수로 태스크 스택 항목의 개수 우선순위, 전달 파라미터 등을 설정한다.

## TaskDelete() 함수

태스크 객체를 없애주는 역할을 하는 함수

## TaskSuspend() 함수

해당 태스크 핸들러를 매개변수로 받아 태스크를 blocked 상태로 진입하게 만든다.

## vTaskPrioritySet(), vTaskResume()

각각 태스크 우선순위를 재설정하는 함수와, 그 태스크를 변경된 우선순위에 맞춰 다시 실행시키는 함수를 가리킨다.
	
## TaskDelay() 함수

1초 만큼 task가 잠시 blocked 상테에 가있다가 다시 ready=>running 상태로 진입
runnig task 가 아예 비어있는 것을 막기 위해 우선순위가 가장 낮은 idle task 를 만들고 비어있을 경우 idle task가 running 상태로 진입
TaskDelay 함수를 통해 각 태스크가 할당받을 시간을 정해 놓고 번갈아가며 task가 running 상태에 진입할 수 있도록하여 멀티태스킹을 구현한다.

## 우선순위와 실행시간의 관계

우선순위가 높다고 그 task가 자주, 오래 실행되는 것이 아니다. 
=> 휴면을 적게 할수록 오래 실행한다.

즉 우선순위가 높고 그 task가 휴면을 적게 한다면 자주, 오래 실행할 것이다.


## printf(), fflush() 함수

printf() 함수의 경우 문자열 버퍼가 있고 그 버퍼가 꽉 채워져야 버퍼를 배출한다.
fflush(stdout) 함수의 경우 문자열 버퍼를 배출하고 버퍼를 비운다.
==> fflush(stdout) 의 경우 UART 를 통해 HW 동작을 야기하고 화면 상에 출력하기 때문에 동작이 상대적으로 느리다.